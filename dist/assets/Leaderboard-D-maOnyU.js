import{j as e}from"./ui-BoKmkzIG.js";import{r as a,e as s}from"./vendor-C3gKaNvt.js";import{r,g as t,s as n,q as i,o as l,a as d,i as o,b as c}from"./firebase-BeVwnubw.js";const m={apiKey:"AIzaSyA_w7oAXXQVCfWuWXSiG9j2wI6o0GGmwjM",authDomain:"mathedu-leaderboard.firebaseapp.com",projectId:"mathedu-leaderboard",storageBucket:"mathedu-leaderboard.appspot.com",messagingSenderId:"485273185384",appId:"1:485273185384:web:ebc257b3adb7b7a70fd5c2",databaseURL:"https://mathedu-leaderboard-default-rtdb.asia-southeast1.firebasedatabase.app"};let u,x;try{u||(u=o(m),x=c(u))}catch(y){console.warn("Firebase initialization failed:",y)}const g=[{_id:"1",username:"SiAhli123",score:1250,rank:1},{_id:"2",username:"MathWizard",score:1100,rank:2},{_id:"3",username:"BrilliantMind",score:950,rank:3},{_id:"4",username:"PecintaAljabar",score:820,rank:4},{_id:"5",username:"KalkulusKing",score:780,rank:5},{_id:"6",username:"GeometriGuru",score:740,rank:6},{_id:"7",username:"TrigonometriPro",score:690,rank:7},{_id:"8",username:"AlgoritmaMaster",score:650,rank:8},{_id:"9",username:"StatistikStar",score:620,rank:9},{_id:"10",username:"ProbabilitasPrima",score:590,rank:10}],p=s.memo((({user:a,isCurrentUser:s})=>e.jsxs("tr",{className:"hover:bg-gray-50 "+(s?"bg-blue-50":""),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center "+(1===a.rank?"bg-yellow-100 text-yellow-800":2===a.rank?"bg-gray-100 text-gray-800":3===a.rank?"bg-yellow-600 text-white":"bg-blue-100 text-blue-800"),children:a.rank})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900 flex items-center",children:[a.username,s&&e.jsx("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:"Anda"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900 font-semibold",children:a.score})})]}))),h=()=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-200"})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded"})})]}),b=()=>{const[s,o]=a.useState([]),[c,m]=a.useState(!0),[u,b]=a.useState(!0),[y,j]=a.useState(null),[f,w]=a.useState(null),[k,N]=a.useState(!1),[v,S]=a.useState(1),[P,_]=a.useState(0),I=a.useCallback((async()=>{if(x)try{const e=JSON.parse(localStorage.getItem("user")||"{}");if(!e||!e.id)return;const a=JSON.parse(localStorage.getItem("userProgress")||"{}"),s=r(x,`users/${e.id}`);await t(s);n(s,{id:e.id,username:e.name||e.email&&e.email.split("@")[0]||"User",email:e.email||"",score:a.xpPoints||0,lastUpdated:(new Date).toISOString()})}catch(e){console.error("Error syncing user to Firebase:",e)}else console.warn("Firebase database not available. Using sample data.")}),[]),M=a.useCallback((()=>{try{const e=JSON.parse(localStorage.getItem("user")||"{}");if(!e||!e.id)return g;const a=JSON.parse(localStorage.getItem("userProgress")||"{}");if(g.some((a=>a._id===e.id)))return g.map((s=>s._id===e.id?{...s,username:e.name||e.email&&e.email.split("@")[0]||"User",score:a.xpPoints||0}:s)).sort(((e,a)=>a.score-e.score)).map(((e,a)=>({...e,rank:a+1})));return[...g,{_id:e.id,username:e.name||e.email&&e.email.split("@")[0]||"User",score:a.xpPoints||0}].sort(((e,a)=>a.score-e.score)).map(((e,a)=>({...e,rank:a+1})))}catch(e){return console.error("Error processing user data:",e),g}}),[]);a.useCallback((async()=>{if(f&&f.id)try{const e=JSON.parse(localStorage.getItem("userProgress")||"{}"),a=Math.floor(41*Math.random())+10,s=(e.xpPoints||0)+a;if(e.xpPoints=s,localStorage.setItem("userProgress",JSON.stringify(e)),x){const e=r(x,`users/${f.id}`),a=await t(e);if(a.exists()){const r=a.val();n(e,{...r,score:s,lastUpdated:(new Date).toISOString()})}}I()}catch(e){console.error("Error adding random XP:",e)}}),[f,I]),a.useEffect((()=>{(async()=>{try{m(!0);const e=JSON.parse(localStorage.getItem("user")||"{}");if(w(e),!x){console.warn("Firebase not available, using sample data");const e=M();return o(e),_(e.length),N(!0),m(!1),void b(!1)}I();const a=r(x,"users"),s=i(a,l("score")),t=setTimeout((()=>{if(c){console.warn("Firebase taking too long, using sample data");const e=M();o(e),_(e.length),N(!0),m(!1),b(!1)}}),3e3),n=d(s,(e=>{if(clearTimeout(t),e.exists()){const a=e.val(),s=Object.keys(a).map((e=>({_id:e,...a[e]}))).sort(((e,a)=>a.score-e.score)).map(((e,a)=>({...e,rank:a+1})));_(s.length);const r=0,t=Math.min(20*v,s.length),n=s.slice(r,t);o(n),N(!1)}else{const e=M();o(e),_(e.length),N(!0)}m(!1),b(!1),j(null)}),(e=>{console.error("Error fetching leaderboard data:",e),j("Terjadi kesalahan saat memuat data leaderboard");const a=M();o(a),_(a.length),N(!0),m(!1),b(!1),clearTimeout(t)}));return()=>{n&&n(),clearTimeout(t)}}catch(e){console.error("Error setting up Firebase:",e),j("Terjadi kesalahan saat menghubungkan ke database");const a=M();o(a),_(a.length),N(!0),m(!1),b(!1)}})()}),[v,M,I]),a.useEffect((()=>{const e=e=>{"userProgress"===e.key&&I()};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}),[I]);const U=a.useCallback((()=>{!c&&s.length<P&&S((e=>e+1))}),[c,s.length,P]);return a.useMemo((()=>f&&s.length?s.findIndex((e=>e._id===f.id))+1:null),[f,s]),u?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-8 text-center",children:"Leaderboard Pengguna"}),e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Peringkat"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Username"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Skor (XP)"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Array(10).fill(0).map(((a,s)=>e.jsx(h,{},s)))})]})})]}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-8 text-center",children:"Leaderboard Pengguna"}),y&&e.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6",role:"alert",children:e.jsx("p",{children:y})}),e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Peringkat"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Username"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Skor (XP)"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[s.length>0?s.map((a=>e.jsx(p,{user:a,isCurrentUser:f&&a._id===f.id},a._id))):e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"px-6 py-4 text-center text-gray-500",children:"Belum ada data pengguna"})}),c&&Array(3).fill(0).map(((a,s)=>e.jsx(h,{},`loading-${s}`)))]})]})}),s.length<P&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:U,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",disabled:c,children:c?"Memuat...":"Muat Lebih Banyak"})}),e.jsxs("div",{className:"mt-6 text-center text-sm text-gray-600",children:[e.jsx("p",{children:"Data peringkat disinkronkan secara realtime untuk semua pengguna."}),k&&e.jsx("p",{className:"text-yellow-600 mt-1",children:"Menggunakan data contoh karena tidak terhubung ke database."})]}),!1]})};export{b as default};
