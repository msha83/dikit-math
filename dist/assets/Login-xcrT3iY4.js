import{j as a}from"./ui-BoKmkzIG.js";import{b as e,r as s,L as i}from"./vendor-C3gKaNvt.js";import{c as n,r,g as l,d as t}from"./firebase-BeVwnubw.js";import{a as o,d,f as c}from"./firebase-DRWWrR8x.js";const m=()=>{const m=e(),[u,h]=s.useState({email:"",password:""}),[g,k]=s.useState(""),[j,x]=s.useState(!1),[f,b]=s.useState(!1),[p,v]=s.useState(!0);s.useEffect((()=>{if(c){b(!0);const a=t(o,(a=>{a&&m("/dashboard"),v(!1)}));return()=>a()}k("Firebase tidak terinitialisasi dengan benar. Harap refresh halaman atau hubungi administrator."),v(!1)}),[m]);const N=a=>{const{name:e,value:s}=a.target;h((a=>({...a,[e]:s.trim()}))),g&&k("")};return p?a.jsxs("div",{className:"login-container",children:[a.jsxs("div",{className:"login-form-container skeleton-container",children:[a.jsxs("div",{className:"login-header",children:[a.jsx("div",{className:"skeleton-logo"}),a.jsx("div",{className:"skeleton-title"}),a.jsx("div",{className:"skeleton-text"})]}),a.jsxs("div",{className:"login-form skeleton-form",children:[a.jsx("div",{className:"skeleton-heading"}),a.jsx("div",{className:"skeleton-input"}),a.jsx("div",{className:"skeleton-input"}),a.jsx("div",{className:"skeleton-button"}),a.jsx("div",{className:"skeleton-links"})]})]}),a.jsx("div",{className:"login-info skeleton-info",children:a.jsx("div",{className:"skeleton-info-content"})})]}):a.jsxs("div",{className:"login-container",children:[a.jsxs("div",{className:"login-form-container",children:[a.jsxs("div",{className:"login-header",children:[a.jsx("img",{src:"/logo.png",alt:"DiKit Logo",className:"login-logo"}),a.jsx("h1",{children:"DiKit"}),a.jsx("p",{children:"Platform Pembelajaran Matematika Interaktif"})]}),a.jsxs("form",{onSubmit:async a=>{a.preventDefault(),k(""),x(!0);const{email:e,password:s}=u;if(!e||!s)return k("Semua field harus diisi"),void x(!1);if(!f)return k("Firebase tidak terinitialisasi dengan benar. Harap refresh halaman atau hubungi administrator."),void x(!1);try{console.log("Mencoba login dengan email:",e);const a=(await n(o,e,s)).user;console.log("Login berhasil, mendapatkan data user dari database");const t=r(d,`users/${a.uid}`);try{const e=await l(t);if(e.exists()){const s=e.val();localStorage.setItem("token",a.accessToken),localStorage.setItem("userId",a.uid),localStorage.setItem("user",JSON.stringify({id:a.uid,name:s.name||"",email:a.email,onboarded:s.onboarded||!1})),s.onboarded?m("/dashboard"):m("/onboarding")}else localStorage.setItem("token",a.accessToken),localStorage.setItem("userId",a.uid),localStorage.setItem("user",JSON.stringify({id:a.uid,name:"",email:a.email,onboarded:!1})),m("/onboarding")}catch(i){console.error("Database error:",i),k("Gagal mengambil data pengguna. Silakan coba lagi.")}}catch(t){switch(console.error("Login error:",t),console.error("Error code:",t.code),console.error("Error message:",t.message),t.code){case"auth/user-not-found":k("Email tidak terdaftar. Silakan daftar terlebih dahulu.");break;case"auth/wrong-password":k("Password salah. Silakan coba lagi.");break;case"auth/invalid-email":k("Format email tidak valid.");break;case"auth/invalid-credential":k("Email atau password salah. Silakan coba lagi.");break;case"auth/too-many-requests":k("Terlalu banyak percobaan login. Silakan coba lagi nanti.");break;case"auth/network-request-failed":k("Gagal terhubung ke server. Periksa koneksi internet Anda.");break;case"auth/api-key-not-valid":k("Konfigurasi API tidak valid. Silakan hubungi administrator.");break;default:k(`Terjadi kesalahan (${t.code}). Silakan coba lagi nanti.`)}}finally{x(!1)}},className:"login-form",children:[a.jsx("h2",{children:"Masuk ke Akun"}),g&&a.jsx("div",{className:"error-message",children:g}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"email",children:"Email"}),a.jsx("input",{type:"email",id:"email",name:"email",value:u.email,onChange:N,placeholder:"Masukkan email Anda",className:g&&!u.email?"input-error":"",required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"password",children:"Password"}),a.jsx("input",{type:"password",id:"password",name:"password",value:u.password,onChange:N,placeholder:"Masukkan password Anda",className:g&&!u.password?"input-error":"",required:!0})]}),a.jsx("button",{type:"submit",className:"login-button",disabled:j||!f,children:j?"Memproses...":"Masuk"}),!f&&a.jsx("div",{className:"firebase-error-message",children:"Firebase tidak terinitialisasi dengan benar. Silakan refresh halaman atau periksa koneksi internet Anda."}),a.jsxs("div",{className:"login-links",children:[a.jsxs("p",{children:["Belum punya akun? ",a.jsx(i,{to:"/register",children:"Daftar sekarang"})]}),a.jsx("p",{children:a.jsx(i,{to:"/forgot-password",children:"Lupa password?"})})]})]})]}),a.jsx("div",{className:"login-info",children:a.jsxs("div",{className:"login-info-content",children:[a.jsx("h2",{children:"Selamat Datang di DiKit"}),a.jsx("p",{children:"Platform pembelajaran matematika yang dirancang untuk membantu siswa memahami konsep matematika dengan cara yang menyenangkan dan interaktif."}),a.jsxs("div",{className:"login-features",children:[a.jsxs("div",{className:"feature",children:[a.jsx("div",{className:"feature-icon",children:"üéØ"}),a.jsxs("div",{className:"feature-text",children:[a.jsx("h3",{children:"Pembelajaran Terarah"}),a.jsx("p",{children:"Materi dan latihan soal sesuai dengan kurikulum"})]})]}),a.jsxs("div",{className:"feature",children:[a.jsx("div",{className:"feature-icon",children:"üèÜ"}),a.jsxs("div",{className:"feature-text",children:[a.jsx("h3",{children:"Sistem Gamifikasi"}),a.jsx("p",{children:"Belajar lebih menyenangkan dengan poin dan pencapaian"})]})]}),a.jsxs("div",{className:"feature",children:[a.jsx("div",{className:"feature-icon",children:"üìä"}),a.jsxs("div",{className:"feature-text",children:[a.jsx("h3",{children:"Pantau Perkembangan"}),a.jsx("p",{children:"Lacak kemajuan belajar Anda secara real-time"})]})]})]})]})})]})};export{m as default};
